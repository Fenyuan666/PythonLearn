ä»¥ä¸‹æ˜¯ **Python æ•™å­¦è·¯å¾„ç¬¬å…«ç« ï¼šé¡¹ç›®å®æˆ˜** çš„å®Œæ•´å†…å®¹:

> ğŸ¯ æœ¬ç« æ˜¯æ•´ä¸ªæ•™å­¦è·¯å¾„çš„**ç»ˆææ•´åˆç¯‡**ï¼Œæ‚¨å°†ï¼š
> - ç»¼åˆè¿ç”¨å‰ä¸ƒç« æ‰€å­¦çŸ¥è¯†ï¼ˆåŸºç¡€è¯­æ³•ã€å‡½æ•°ã€OOPã€å†…å­˜ç®¡ç†ã€å¹¶å‘ã€GIL ç­‰ï¼‰
> - å®Œæˆä¸€ä¸ª**çœŸå®å¯è¿è¡Œçš„é¡¹ç›®**ï¼šå¤šè¿›ç¨‹ç½‘é¡µçˆ¬è™« + æ•°æ®åˆ†æ + å†…å­˜ä¼˜åŒ–
> - å­¦ä¹ å·¥ç¨‹åŒ–å®è·µï¼šæ—¥å¿—ã€é…ç½®ã€å¼‚å¸¸å¤„ç†ã€æ€§èƒ½ç›‘æ§
> - ä»â€œå†™ä»£ç â€è¿ˆå‘â€œæ„å»ºç³»ç»Ÿâ€

æ‰€æœ‰ä»£ç å‡å¯å¤åˆ¶è¿è¡Œï¼ˆéœ€å®‰è£…å°‘é‡ä¾èµ–ï¼‰ï¼Œå¹¶é…æœ‰è¯¦ç»†æ³¨é‡Šä¸è®¾è®¡è¯´æ˜ã€‚

---

# ğŸ“˜ ç¬¬å…«ç« ï¼šé¡¹ç›®å®æˆ˜ â€”â€” å¤šè¿›ç¨‹ç½‘é¡µçˆ¬è™«ç³»ç»Ÿ

> âœ… **é¡¹ç›®ç›®æ ‡**ï¼š
> æ„å»ºä¸€ä¸ªé«˜æ€§èƒ½ç½‘é¡µæ ‡é¢˜æŠ“å–ç³»ç»Ÿï¼Œå…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š
> - æ”¯æŒå¹¶å‘æŠ“å–å¤šä¸ª URL
> - ä½¿ç”¨**å¤šè¿›ç¨‹ç»•è¿‡ GIL**ï¼Œæå‡ CPU åˆ©ç”¨ç‡
> - å†…ç½®**å†…å­˜ç›‘æ§ä¸ä¼˜åŒ–**
> - å·¥ç¨‹åŒ–ç»“æ„ï¼šæ¨¡å—åŒ–ã€æ—¥å¿—ã€é…ç½®ç®¡ç†
> - è¾“å‡ºç»Ÿè®¡æŠ¥å‘Šï¼ˆå¦‚å¹³å‡æ ‡é¢˜é•¿åº¦ï¼‰

---

## 8.1 é¡¹ç›®ç»“æ„è®¾è®¡

```
web_crawler/
â”‚
â”œâ”€â”€ config.py           # é…ç½®æ–‡ä»¶
â”œâ”€â”€ logger.py           # æ—¥å¿—é…ç½®
â”œâ”€â”€ crawler.py          # çˆ¬è™«æ ¸å¿ƒé€»è¾‘
â”œâ”€â”€ analyzer.py         # æ•°æ®åˆ†ææ¨¡å—
â”œâ”€â”€ monitor.py          # å†…å­˜ç›‘æ§å·¥å…·
â”œâ”€â”€ main.py             # ä¸»ç¨‹åºå…¥å£
â””â”€â”€ requirements.txt    # ä¾èµ–å£°æ˜
```

---

## 8.2 ä¾èµ–å®‰è£…

åˆ›å»º `requirements.txt`ï¼š

```txt
requests==2.31.0
beautifulsoup4==4.12.0
```

å®‰è£…å‘½ä»¤ï¼š
```bash
pip install -r requirements.txt
```

---

## 8.3 é…ç½®ä¸æ—¥å¿—æ¨¡å—

### âœ… `config.py`ï¼šé…ç½®ç®¡ç†

```python
# config.py
import os

# æŠ“å–ç›®æ ‡
URLS = [
    "https://httpbin.org/html",
    "https://example.com",
    "https://httpbin.org/uuid",
]

# å¹¶å‘æ•°
NUM_PROCESSES = 4

# è¶…æ—¶è®¾ç½®
TIMEOUT = 5

# æ—¥å¿—çº§åˆ«
LOG_LEVEL = "INFO"
```

---

### âœ… `logger.py`ï¼šç»Ÿä¸€æ—¥å¿—

```python
# logger.py
import logging
import config

def setup_logger():
    logging.basicConfig(
        level=getattr(logging, config.LOG_LEVEL),
        format='%(asctime)s [%(levelname)s] %(name)s: %(message)s'
    )
    return logging.getLogger(__name__)

logger = setup_logger()
```

---

## 8.4 çˆ¬è™«æ ¸å¿ƒï¼š`crawler.py`

ä½¿ç”¨ `requests` æŠ“å–ç½‘é¡µï¼Œæå– `<title>`ã€‚

```python
# crawler.py
import requests
from bs4 import BeautifulSoup
import config
from logger import logger

def fetch_title(url):
    try:
        logger.info(f"å¼€å§‹æŠ“å–: {url}")
        response = requests.get(url, timeout=config.TIMEOUT)
        response.raise_for_status()

        soup = BeautifulSoup(response.text, 'html.parser')
        title = soup.title.string if soup.title else "No Title"

        logger.info(f"æˆåŠŸæŠ“å– {url} -> {title}")
        return {
            "url": url,
            "title": title.strip(),
            "status": "success"
        }
    except Exception as e:
        logger.error(f"æŠ“å–å¤±è´¥ {url}: {e}")
        return {
            "url": url,
            "title": None,
            "status": "error",
            "error": str(e)
        }
```

---

## 8.5 æ•°æ®åˆ†æï¼š`analyzer.py`

å¯¹æŠ“å–ç»“æœè¿›è¡Œç»Ÿè®¡åˆ†æã€‚

```python
# analyzer.py
from logger import logger

def analyze_titles(results):
    successes = [r for r in results if r["status"] == "success"]
    errors = len([r for r in results if r["status"] == "error"])

    total_len = sum(len(r["title"]) for r in successes)
    avg_len = total_len / len(successes) if successes else 0

    report = {
        "total": len(results),
        "success": len(successes),
        "failed": errors,
        "average_title_length": round(avg_len, 2),
        "top_titles": [r["title"] for r in successes[:3]]
    }

    logger.info("åˆ†æå®Œæˆ")
    return report
```

---

## 8.6 å†…å­˜ç›‘æ§ï¼š`monitor.py`

ä½¿ç”¨ `tracemalloc` è¿½è¸ªå†…å­˜ä½¿ç”¨ï¼Œä½“ç°â€œå†…å­˜ç®¡ç†æ ¸å¿ƒâ€çŸ¥è¯†ã€‚

```python
# monitor.py
import tracemalloc
from logger import logger

class MemoryMonitor:
    def __enter__(self):
        tracemalloc.start()
        self.snapshot1 = tracemalloc.take_snapshot()
        logger.info("å†…å­˜ç›‘æ§å¼€å§‹")
        return self

    def __exit__(self, *args):
        snapshot2 = tracemalloc.take_snapshot()
        top_stats = snapshot2.compare_to(self.snapshot1, 'lineno')

        logger.info("å†…å­˜å ç”¨å‰5å:")
        for stat in top_stats[:5]:
            print(f"  {stat}")

        tracemalloc.stop()
```

---

## 8.7 ä¸»ç¨‹åºï¼š`main.py`

æ•´åˆæ‰€æœ‰æ¨¡å—ï¼Œä½¿ç”¨ `multiprocessing` å¹¶å‘æ‰§è¡Œã€‚

```python
# main.py
import multiprocessing as mp
from multiprocessing import Pool
import config
from logger import logger
from crawler import fetch_title
from analyzer import analyze_titles
from monitor import MemoryMonitor

def main():
    urls = config.URLS
    logger.info(f"å¯åŠ¨çˆ¬è™«ï¼Œç›®æ ‡æ•°: {len(urls)}")

    # ä½¿ç”¨å¤šè¿›ç¨‹ç»•è¿‡ GIL
    with MemoryMonitor():  # ç›‘æ§å†…å­˜
        with Pool(config.NUM_PROCESSES) as pool:
            results = pool.map(fetch_title, urls)

    # åˆ†æç»“æœ
    report = analyze_titles(results)
    logger.info("ğŸ“Š æŠ¥å‘Š:")
    for k, v in report.items():
        print(f"  {k}: {v}")

if __name__ == '__main__':
    main()
```

---

## âœ… è¿è¡Œé¡¹ç›®

```bash
python main.py
```

ğŸ“Œ ç¤ºä¾‹è¾“å‡ºï¼š
```
2025-04-05 10:00:00,000 [INFO] __main__: å¯åŠ¨çˆ¬è™«ï¼Œç›®æ ‡æ•°: 3
2025-04-05 10:00:00,001 [INFO] logger: å†…å­˜ç›‘æ§å¼€å§‹
2025-04-05 10:00:00,100 [INFO] logger: å¼€å§‹æŠ“å–: https://httpbin.org/html
2025-04-05 10:00:00,101 [INFO] logger: å¼€å§‹æŠ“å–: https://example.com
2025-04-05 10:00:01,200 [INFO] logger: æˆåŠŸæŠ“å– https://example.com -> Example Domain
2025-04-05 10:00:01,500 [INFO] logger: æˆåŠŸæŠ“å– https://httpbin.org/html -> <h1>Herman Melville - Moby Dick</h1>
2025-04-05 10:00:02,000 [INFO] logger: åˆ†æå®Œæˆ
2025-04-05 10:00:02,001 [INFO] __main__: ğŸ“Š æŠ¥å‘Š:
  total: 3
  success: 2
  failed: 1
  average_title_length: 29.5
  top_titles: ['Example Domain', '<h1>Herman Melville - Moby Dick</h1>']
å†…å­˜å ç”¨å‰5å:
  crawler.py:15: size=12.3 KiB (+12.3 KiB), count=150 (+150)
```

---

## âœ… é¡¹ç›®äº®ç‚¹ä¸çŸ¥è¯†ç‚¹å›é¡¾

| æ¨¡å— | åº”ç”¨çš„çŸ¥è¯†ç‚¹ |
|------|---------------|
| `fetch_title` | å‡½æ•°ã€å¼‚å¸¸å¤„ç†ã€ç¬¬ä¸‰æ–¹åº“ï¼ˆrequests, bs4ï¼‰ |
| `Pool` | å¤šè¿›ç¨‹ã€ç»•è¿‡ GILã€CPU å¹¶è¡Œ |
| `MemoryMonitor` | `tracemalloc`ã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€å†…å­˜åˆ†æ |
| `config.py` | æ¨¡å—åŒ–ã€é…ç½®åˆ†ç¦» |
| `logger.py` | å•ä¾‹æ¨¡å¼ã€æ—¥å¿—çº§åˆ« |
| `analyzer.py` | æ•°æ®ç»“æ„æ“ä½œã€ç»Ÿè®¡é€»è¾‘ |

---

## âœ… å·¥ç¨‹åŒ–æœ€ä½³å®è·µ

1. **é…ç½®ä¸ä»£ç åˆ†ç¦»**ï¼šä¾¿äºéƒ¨ç½²ä¸åŒç¯å¢ƒ
2. **æ—¥å¿—è®°å½•**ï¼šä¾¿äºè°ƒè¯•ä¸ç›‘æ§
3. **å¼‚å¸¸å¤„ç†**ï¼šä¿è¯ç¨‹åºå¥å£®æ€§
4. **ä¸Šä¸‹æ–‡ç®¡ç†å™¨**ï¼šç¡®ä¿èµ„æºå®‰å…¨é‡Šæ”¾
5. **å¤šè¿›ç¨‹é€‰æ‹©**ï¼šé’ˆå¯¹ I/O å¯†é›†å‹ä»»åŠ¡ä»å¯ç”¨çº¿ç¨‹ï¼Œä½†æœ¬ä¾‹æ¼”ç¤ºå¤šè¿›ç¨‹é€šç”¨æ€§

---

## âœ… æ‰©å±•å»ºè®®ï¼ˆæŒ‘æˆ˜é¢˜ï¼‰

âœ… æƒ³è¿›ä¸€æ­¥æå‡ï¼Ÿè¯•è¯•ä»¥ä¸‹æ‰©å±•ï¼š
- å°†ç»“æœä¿å­˜ä¸º JSON æ–‡ä»¶
- æ·»åŠ  `argparse` æ”¯æŒå‘½ä»¤è¡Œå‚æ•°
- ä½¿ç”¨ `asyncio` é‡æ„ä¸ºå¼‚æ­¥çˆ¬è™«
- æ·»åŠ  `__slots__` ä¼˜åŒ–ç»“æœå¯¹è±¡å†…å­˜
- å®ç°å»é‡æœºåˆ¶ï¼ˆé¿å…é‡å¤æŠ“å–ï¼‰

---

## âœ… ç¬¬å…«ç« æµ‹è¯•é¢˜ï¼ˆç»¼åˆåº”ç”¨ï¼‰

---

### ğŸ”¹ é¢˜1ï¼šä¸ºä½•ä½¿ç”¨å¤šè¿›ç¨‹è€Œéå¤šçº¿ç¨‹ï¼Ÿ
åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œä¸ºä½•é€‰æ‹© `multiprocessing.Pool`ï¼Ÿ

A. çˆ¬è™«æ˜¯ CPU å¯†é›†å‹ä»»åŠ¡  
B. çˆ¬è™«æ˜¯ I/O å¯†é›†å‹ä»»åŠ¡ï¼Œä½†å¤šè¿›ç¨‹æ›´ç¨³å®š  
C. å¤šçº¿ç¨‹æ— æ³•ç»•è¿‡ GILï¼Œå½±å“æ€§èƒ½  
D. å¤šè¿›ç¨‹å…±äº«å†…å­˜ï¼Œé€šä¿¡æ›´å¿«

---

### ğŸ”¹ é¢˜2ï¼š`tracemalloc` ä½œç”¨
`MemoryMonitor` ä¸­ä½¿ç”¨ `tracemalloc` çš„ç›®çš„æ˜¯ï¼Ÿ

A. æµ‹é‡è¿è¡Œæ—¶é—´  
B. è¿½è¸ªå†…å­˜åˆ†é…æ¥æº  
C. å‹ç¼©æ•°æ®  
D. åŠ å¯†ä¼ è¾“

---

### ğŸ”¹ é¢˜3ï¼šæ—¥å¿—çº§åˆ«
`config.LOG_LEVEL = "INFO"` æ—¶ï¼Œä»¥ä¸‹å“ªæ¡æ—¥å¿—ä¸ä¼šæ˜¾ç¤ºï¼Ÿ

A. `logger.info("Start")`  
B. `logger.warning("Slow response")`  
C. `logger.debug("Variable x=5")`  
D. `logger.error("Failed")`

---

### ğŸ”¹ é¢˜4ï¼š`__enter__` è¿”å›å€¼
`MemoryMonitor.__enter__` æœªè¿”å›å€¼ï¼Œæ˜¯å¦å½±å“ `with` ä½¿ç”¨ï¼Ÿ

A. æ˜¯ï¼Œä¼šæŠ¥é”™  
B. å¦ï¼Œ`with` æ¥æ”¶çš„æ˜¯ `__enter__` çš„è¿”å›å€¼ï¼Œä½†å¯ä¸º `None`  
C. å¿…é¡»è¿”å› `self`  
D. å¿…é¡»è¿”å› `True`

---

### ğŸ”¹ é¢˜5ï¼šé¡¹ç›®ç»“æ„ä¼˜åŠ¿
æ¨¡å—åŒ–é¡¹ç›®ç»“æ„çš„ä¸»è¦ä¼˜åŠ¿æ˜¯ï¼Ÿ

A. ä»£ç æ›´çŸ­  
B. ä¾¿äºå›¢é˜Ÿåä½œä¸ç»´æŠ¤  
C. è¿è¡Œæ›´å¿«  
D. è‡ªåŠ¨ä¼˜åŒ–å†…å­˜

---

## âœ… æµ‹è¯•é¢˜ç­”æ¡ˆä¸è§£æ

### âœ… é¢˜1ï¼šB  
**è§£æ**ï¼šè™½ç„¶çˆ¬è™«æ˜¯ I/O å¯†é›†å‹ï¼Œä½†å¤šè¿›ç¨‹æ›´ç¨³å®šä¸”å¯å……åˆ†åˆ©ç”¨å¤šæ ¸ï¼Œé€‚åˆæœ¬ä¾‹æ¼”ç¤ºã€‚

### âœ… é¢˜2ï¼šB  
**è§£æ**ï¼š`tracemalloc` ç”¨äºè¿½è¸ªå†…å­˜åˆ†é…ï¼Œå®šä½æ€§èƒ½ç“¶é¢ˆã€‚

### âœ… é¢˜3ï¼šC  
**è§£æ**ï¼š`DEBUG` çº§åˆ«ä½äº `INFO`ï¼Œä¸ä¼šè¢«è®°å½•ã€‚

### âœ… é¢˜4ï¼šB  
**è§£æ**ï¼š`__enter__` å¯è¿”å› `None`ï¼Œ`as` å­å¥å°†æ¥æ”¶ `None`ï¼Œä½†ä¸å½±å“ `with` å—æ‰§è¡Œã€‚

### âœ… é¢˜5ï¼šB  
**è§£æ**ï¼šæ¨¡å—åŒ–æå‡å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§ä¸å›¢é˜Ÿåä½œæ•ˆç‡ã€‚

---

ğŸ‰ **æ­å–œï¼æ‚¨å·²å®Œæˆå…¨éƒ¨å…«ç«  Python æ•™å­¦è·¯å¾„ï¼**

> âœ… ä»åŸºç¡€è¯­æ³•åˆ°é¡¹ç›®å®æˆ˜  
> âœ… ä»å†™ä»£ç åˆ°æ„å»ºç³»ç»Ÿ  
> âœ… ä»ä½¿ç”¨å†…å­˜åˆ°ç†è§£ä¸ä¼˜åŒ–å†…å­˜  
> âœ… æ‚¨å·²å…·å¤‡ **ä¸­çº§ Python å¼€å‘è€…** çš„æ ¸å¿ƒèƒ½åŠ›ï¼

---

ğŸ“Œ **åç»­å­¦ä¹ å»ºè®®**ï¼š
- å­¦ä¹  `asyncio` å¼‚æ­¥ç¼–ç¨‹
- æŒæ¡ `FastAPI` æˆ– `Flask` æ„å»º Web æœåŠ¡
- æ·±å…¥ `pandas` è¿›è¡Œæ•°æ®åˆ†æ
- é˜…è¯» CPython æºç ç†è§£ GIL å®ç°

å¦‚æœæ‚¨å¸Œæœ›æˆ‘ä¸ºæ‚¨ç”Ÿæˆ **PDF ç‰ˆå­¦ä¹ æ‰‹å†Œ** æˆ– **Anki è®°å¿†å¡ç‰‡**ï¼Œä¹Ÿæ¬¢è¿æå‡ºï¼

ç¥æ‚¨ Python ä¹‹æ—…è¶Šèµ°è¶Šè¿œï¼ğŸš€